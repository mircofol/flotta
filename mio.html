<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>San Martino Pro v12.11</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            -webkit-tap-highlight-color: transparent; 
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .nav-btn.active { 
            background-color: #1e40af; 
            color: white; 
            box-shadow: 0 10px 15px -3px rgba(30, 64, 175, 0.3);
        }
        select { appearance: none; -webkit-appearance: none; }
        
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .locked-section {
            filter: grayscale(1) blur(2px);
            pointer-events: none;
            opacity: 0.5;
        }

        .btn-disabled {
            background-color: #94a3b8 !important;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .progress-ring { transition: stroke-dashoffset 0.35s; transform: rotate(-90deg); transform-origin: 50% 50%; }
        
        .scrollbar-hide::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 pb-32">

    <!-- HEADER -->
    <header class="bg-blue-900 text-white p-6 rounded-b-[2.5rem] shadow-xl sticky top-0 z-50">
        <div class="max-w-md mx-auto space-y-4">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-xl font-black tracking-tighter italic uppercase leading-none">
                        San Martino <span class="text-blue-400">Pro</span>
                    </h1>
                    <p class="text-[9px] font-bold opacity-60 uppercase tracking-widest mt-1">Fleet Management v12.11</p>
                </div>
                <div id="status-dot" class="w-3 h-3 bg-rose-500 rounded-full border-2 border-blue-900"></div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div class="relative bg-blue-800/50 rounded-xl px-3 py-2 border border-blue-700/50">
                    <label class="block text-[8px] font-black uppercase opacity-60 mb-1 tracking-tighter">Autista</label>
                    <select id="driver-select" onchange="validateCaricoAccess()" class="bg-transparent w-full text-[11px] font-bold outline-none border-none text-white">
                        <option value="" class="text-slate-900">SELEZIONA...</option>
                    </select>
                </div>
                <div class="relative bg-blue-800/50 rounded-xl px-3 py-2 border border-blue-700/50">
                    <label class="block text-[8px] font-black uppercase opacity-60 mb-1 tracking-tighter">Targa Mezzo</label>
                    <select id="truck-select" onchange="validateCaricoAccess()" class="bg-transparent w-full text-[11px] font-bold outline-none border-none text-white">
                        <option value="" class="text-slate-900">SELEZIONA...</option>
                    </select>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-md mx-auto p-4">

        <!-- TAB 1: CARICO -->
        <section id="tab-carico" class="tab-content active fade-in space-y-4">
            <div class="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-100">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="text-[9px] font-black uppercase text-slate-400 tracking-widest">Controllo Carico</h2>
                    <span id="timer-carico" class="text-lg font-black text-slate-300 font-mono tracking-wider">00:00:00</span>
                </div>

                <div class="mb-4">
                    <label class="block text-[8px] font-black text-slate-400 uppercase mb-1 ml-1">Dati Obbligatori Carico</label>
                    <input type="number" id="distinta-num" oninput="validateCaricoAccess()" placeholder="N° DISTINTA" class="w-full bg-slate-50 p-4 rounded-xl font-black text-lg outline-none border-2 border-transparent focus:border-blue-500 text-center shadow-inner">
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                    <button id="btn-start-carico" onclick="startActionTimer('carico')" class="btn-disabled bg-emerald-600 text-white py-4 rounded-xl font-black uppercase text-[11px] flex items-center justify-center gap-2 shadow-sm active:scale-95 transition-all">
                        <i data-lucide="play" class="w-4 h-4"></i> Inizio Carico
                    </button>
                    <button id="btn-stop-carico" onclick="stopActionTimer('carico')" class="btn-disabled bg-rose-600 text-white py-4 rounded-xl font-black uppercase text-[11px] flex items-center justify-center gap-2 shadow-sm active:scale-95 transition-all">
                        <i data-lucide="square" class="w-4 h-4"></i> Fine Carico
                    </button>
                </div>
                <p id="carico-hint" class="text-[8px] text-center font-bold text-rose-500 mt-3 uppercase">Seleziona Autista, Targa e Distinta per iniziare</p>
            </div>

            <div class="space-y-3">
                <div class="flex items-center gap-2 px-2">
                    <i data-lucide="history" class="w-3 h-3 text-slate-400"></i>
                    <h3 class="text-[9px] font-black uppercase text-slate-400 tracking-widest">Registro Attività Carico</h3>
                </div>
                <div id="carico-history" class="space-y-2">
                    <div class="bg-slate-100/50 rounded-2xl p-4 text-center border-2 border-dashed border-slate-200">
                        <p class="text-[8px] font-bold text-slate-400 uppercase">Nessuna distinta registrata</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- TAB 2: KM -->
        <section id="tab-km" class="tab-content fade-in space-y-4">
            <div id="km-section-container" class="locked-section">
                <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100">
                    <h2 class="text-[10px] font-black uppercase text-slate-400 tracking-widest text-center mb-6">Gestione Chilometri</h2>
                    <div class="space-y-4">
                        <div class="bg-slate-50 p-4 rounded-3xl border border-slate-100 flex items-center gap-2">
                            <input type="number" id="km-start" placeholder="KM INIZIO" class="flex-1 bg-white p-3 rounded-xl font-black text-lg outline-none border-2 border-transparent focus:border-emerald-500 text-center shadow-sm">
                            <button onclick="logKm('Inizio')" class="bg-emerald-600 text-white px-5 py-3 rounded-xl font-black uppercase text-[10px] shadow-lg active:scale-95">Invia</button>
                        </div>
                        <div class="bg-slate-50 p-4 rounded-3xl border border-slate-100 flex items-center gap-2">
                            <input type="number" id="km-end" placeholder="KM FINE" class="flex-1 bg-white p-3 rounded-xl font-black text-lg outline-none border-2 border-transparent focus:border-rose-500 text-center shadow-sm">
                            <button onclick="logKm('Fine')" class="bg-rose-600 text-white px-5 py-3 rounded-xl font-black uppercase text-[10px] shadow-lg active:scale-95">Invia</button>
                        </div>
                    </div>
                </div>
                <div id="km-history" class="mt-4 space-y-2 px-2"></div>
            </div>
            <div id="km-lock-msg" class="text-center p-10">
                <i data-lucide="info" class="w-8 h-8 mx-auto text-slate-300 mb-2"></i>
                <p class="text-[10px] font-bold text-slate-400 uppercase leading-relaxed">Completa prima la procedura di<br><span class="text-blue-500">Inizio/Fine Carico</span></p>
            </div>
        </section>

        <!-- TAB 3: GASOLIO (NEW) -->
        <section id="tab-gasolio" class="tab-content fade-in space-y-4 pb-10">
            <div class="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100">
                <h2 class="text-[10px] font-black uppercase text-blue-900 tracking-widest text-center mb-6">Rifornimento Gasolio</h2>
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-3">
                        <div class="space-y-1">
                            <label class="text-[8px] font-black text-slate-400 uppercase ml-2">Litri</label>
                            <input type="number" id="gas-litri" oninput="calculateGasPrice()" step="0.01" placeholder="LITRI" class="w-full bg-slate-50 p-4 rounded-2xl font-black text-lg outline-none border-2 border-transparent focus:border-blue-500 text-center">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[8px] font-black text-slate-400 uppercase ml-2">Euro (€)</label>
                            <input type="number" id="gas-euro" oninput="calculateGasPrice()" step="0.01" placeholder="EURO" class="w-full bg-slate-50 p-4 rounded-2xl font-black text-lg outline-none border-2 border-transparent focus:border-blue-500 text-center">
                        </div>
                    </div>
                    
                    <div class="bg-blue-50/50 p-4 rounded-2xl border border-blue-100 flex justify-between items-center">
                        <span class="text-[9px] font-black text-blue-800 uppercase">Prezzo al Litro:</span>
                        <span id="gas-prezzo-litro" class="text-lg font-black text-blue-600 font-mono italic">€ 0.000</span>
                    </div>

                    <button onclick="logGas()" class="w-full bg-blue-900 text-white py-4 rounded-2xl font-black uppercase text-[11px] shadow-xl active:scale-95 transition-all flex items-center justify-center gap-2">
                        <i data-lucide="droplet" class="w-4 h-4"></i> Registra Consumo
                    </button>
                </div>
            </div>

            <div class="space-y-3">
                <div class="flex items-center gap-2 px-2">
                    <i data-lucide="list-ordered" class="w-3 h-3 text-slate-400"></i>
                    <h3 class="text-[9px] font-black uppercase text-slate-400 tracking-widest">Storico Rifornimenti</h3>
                </div>
                <div id="gas-history" class="space-y-2">
                    <div class="bg-slate-100/50 rounded-2xl p-4 text-center border-2 border-dashed border-slate-200">
                        <p class="text-[8px] font-bold text-slate-400 uppercase tracking-tighter">Nessun rifornimento registrato</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- TAB 4: MANUTENZIONE -->
        <section id="tab-manutenzione" class="tab-content fade-in space-y-4 pb-10">
            <!-- Cella Frigo -->
            <div class="bg-white p-5 rounded-[2.5rem] shadow-sm border border-slate-100">
                <div class="flex justify-between items-center mb-4 px-2">
                    <h2 class="text-[10px] font-black uppercase text-blue-900 tracking-widest">Cella Frigo</h2>
                    <span id="timer-frigo" class="text-sm font-black text-cyan-600 font-mono tracking-tighter">00:00:00</span>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <button id="frigo-on-btn" onclick="toggleFridge(true)" class="bg-cyan-50 text-cyan-700 py-3 rounded-2xl font-black uppercase text-[10px] flex items-center justify-center gap-2 border border-cyan-100 active:scale-95">
                        <i data-lucide="zap" class="w-3 h-3"></i> ACCENDI
                    </button>
                    <button id="frigo-off-btn" onclick="toggleFridge(false)" class="bg-slate-50 text-slate-400 py-3 rounded-2xl font-black uppercase text-[10px] flex items-center justify-center gap-2 border border-slate-100 active:scale-95">
                        <i data-lucide="zap-off" class="w-3 h-3"></i> SPEGNI
                    </button>
                </div>
            </div>

            <!-- Stato Liquidi Veicolo -->
            <div class="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-100">
                <h2 class="text-[10px] font-black uppercase text-slate-400 mb-6 tracking-widest text-center">Livelli Liquidi (%)</h2>
                <div class="grid grid-cols-2 gap-y-6">
                    <div class="flex flex-col items-center">
                        <div class="relative h-14 w-14">
                            <svg class="h-14 w-14 progress-ring"><circle class="stroke-slate-100" stroke-width="5" fill="transparent" r="24" cx="28" cy="28"/><circle id="oil-ring" class="stroke-blue-600" stroke-width="5" stroke-dasharray="150.8" stroke-dashoffset="0" fill="transparent" r="24" cx="28" cy="28"/></svg>
                            <div class="absolute inset-0 flex items-center justify-center text-[10px] font-black">100</div>
                        </div>
                        <span class="text-[8px] font-black uppercase mt-1 text-slate-500 text-center">Olio Motore</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="relative h-14 w-14">
                            <svg class="h-14 w-14 progress-ring"><circle class="stroke-slate-100" stroke-width="5" fill="transparent" r="24" cx="28" cy="28"/><circle id="brake-ring" class="stroke-rose-500" stroke-width="5" stroke-dasharray="150.8" stroke-dashoffset="0" fill="transparent" r="24" cx="28" cy="28"/></svg>
                            <div class="absolute inset-0 flex items-center justify-center text-[10px] font-black">100</div>
                        </div>
                        <span class="text-[8px] font-black uppercase mt-1 text-slate-500 text-center">Olio Freni</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="relative h-14 w-14">
                            <svg class="h-14 w-14 progress-ring"><circle class="stroke-slate-100" stroke-width="5" fill="transparent" r="24" cx="28" cy="28"/><circle id="hydro-ring" class="stroke-purple-600" stroke-width="5" stroke-dasharray="150.8" stroke-dashoffset="0" fill="transparent" r="24" cx="28" cy="28"/></svg>
                            <div class="absolute inset-0 flex items-center justify-center text-[10px] font-black">100</div>
                        </div>
                        <span class="text-[8px] font-black uppercase mt-1 text-slate-500 text-center">Olio Irdog</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="relative h-14 w-14">
                            <svg class="h-14 w-14 progress-ring"><circle class="stroke-slate-100" stroke-width="5" fill="transparent" r="24" cx="28" cy="28"/><circle id="coolant-ring" class="stroke-emerald-500" stroke-width="5" stroke-dasharray="150.8" stroke-dashoffset="0" fill="transparent" r="24" cx="28" cy="28"/></svg>
                            <div class="absolute inset-0 flex items-center justify-center text-[10px] font-black">100</div>
                        </div>
                        <span class="text-[8px] font-black uppercase mt-1 text-slate-500 text-center">Liquido Raffr.</span>
                    </div>
                </div>
            </div>

            <!-- USURA GOMME -->
            <div class="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-100">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-2">
                        <i data-lucide="disc" class="w-3 h-3 text-slate-600"></i>
                        <h2 class="text-[10px] font-black uppercase text-slate-600 tracking-widest">Usura Gomme</h2>
                    </div>
                    <select id="tire-axis" class="text-[8px] font-black bg-slate-100 px-3 py-1 rounded-full outline-none border-none">
                        <option value="ANTERIORE">ASSE ANTERIORE</option>
                        <option value="POSTERIORE">ASSE POSTERIORE</option>
                    </select>
                </div>
                <div class="space-y-4">
                    <div class="bg-slate-50 p-4 rounded-2xl">
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-[8px] font-black text-slate-400">STATO BATTISTRADA</span>
                            <span id="tire-pct-label" class="text-[10px] font-black text-blue-600">80%</span>
                        </div>
                        <input type="range" id="tire-range" min="0" max="100" value="80" oninput="updateTireLabel(this.value)" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                    </div>
                    <button onclick="logTires()" class="w-full bg-slate-900 text-white py-3 rounded-xl font-black uppercase text-[10px] shadow-lg active:scale-95 transition-all">Registra Controllo Gomme</button>
                </div>
                <div id="tire-log" class="mt-3 space-y-1 max-h-20 overflow-y-auto scrollbar-hide"></div>
            </div>

            <!-- LAVAGGIO MEZZO -->
            <div class="bg-white p-5 rounded-[2rem] shadow-sm border border-slate-100">
                <div class="flex items-center gap-2 mb-4">
                    <i data-lucide="waves" class="w-3 h-3 text-cyan-500"></i>
                    <h2 class="text-[10px] font-black uppercase text-slate-600 tracking-widest">Lavaggio Mezzo</h2>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="logWash('Esterno')" class="bg-slate-50 border border-slate-100 p-3 rounded-xl flex flex-col items-center gap-1 active:bg-cyan-50 active:border-cyan-200 transition-colors">
                        <i data-lucide="car" class="w-4 h-4 text-slate-400"></i>
                        <span class="text-[8px] font-black uppercase">Esterno</span>
                    </button>
                    <button onclick="logWash('Interno')" class="bg-slate-50 border border-slate-100 p-3 rounded-xl flex flex-col items-center gap-1 active:bg-cyan-50 active:border-cyan-200 transition-colors">
                        <i data-lucide="door-open" class="w-4 h-4 text-slate-400"></i>
                        <span class="text-[8px] font-black uppercase">Interno</span>
                    </button>
                    <button onclick="logWash('Completo')" class="bg-cyan-600 p-3 rounded-xl flex flex-col items-center gap-1 shadow-lg shadow-cyan-100 active:scale-95">
                        <i data-lucide="sparkles" class="w-4 h-4 text-white"></i>
                        <span class="text-[8px] font-black uppercase text-white">Completo</span>
                    </button>
                </div>
                <div id="wash-log" class="mt-3 space-y-1 max-h-24 overflow-y-auto scrollbar-hide"></div>
            </div>
       
...
